# ==================================================
# 本地开发环境 Docker Compose 配置
# 用途: 使用 Nginx 代理本地 Vite 开发服务器，模拟域名访问
# 使用: docker-compose up -d
# ==================================================

version: '3'

services:
  nginx:
    image: nginx:alpine # 使用轻量级 Alpine 版本的 Nginx
    container_name: local-dev-nginx

    # 端口映射: 宿主机端口:容器端口
    ports:
      - '80:80' # HTTP
      - '443:443' # HTTPS (可选，需配置证书)

    # 挂载配置文件 (:ro 表示只读)
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro # Nginx 配置
      - ./nginx/certs:/etc/nginx/certs:ro # SSL 证书目录

    # 关键配置: 让容器能够访问宿主机的服务
    # host.docker.internal 是一个特殊的 DNS 名称，指向宿主机
    # host-gateway 会被 Docker 自动解析为宿主机的实际 IP
    # 这样 Nginx 才能通过 http://host.docker.internal:5173 访问本地 Vite 服务
    extra_hosts:
      - 'host.docker.internal:host-gateway'

    restart: unless-stopped # 容器退出时自动重启（除非手动停止）

    networks:
      - dev-network

# 自定义网络
networks:
  dev-network:
    driver: bridge
